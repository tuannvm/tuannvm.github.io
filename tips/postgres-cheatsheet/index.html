<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Postgres cheatsheet | DevOps Blog</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/colorbox.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://tuannvm.github.io/tips/postgres-cheatsheet/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Tuan Nguyen">
<link rel="prev" href="../../blogs/delete-old-ebs-snaphot/" title="Delete old EBS snaphot" type="text/html">
<meta property="og:site_name" content="DevOps Blog">
<meta property="og:title" content="Postgres cheatsheet">
<meta property="og:url" content="https://tuannvm.github.io/tips/postgres-cheatsheet/">
<meta property="og:description" content="A list of query scenarios on PostgreSQL database which might be helpful in some cases.


Table of Contents

Sample schema
UPDATE
DELETE
WILDCARD
JOIN
SUM, GROUP BY, COUNT
ORDER BY
CREATE TABLE
INSERT
">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-02-15T14:48:55+07:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://tuannvm.github.io/">

                <span id="blog-title">DevOps Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../categories/blogs/">Blogs</a>
                </li>
<li>
<a href="../../categories/tips/">Tips</a>
                </li>
<li>
<a href="../../pages/about-me/">About Me</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://tuannvm.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Postgres cheatsheet</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Tuan Nguyen
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2017-02-15T14:48:55+07:00" itemprop="datePublished" title="2017-02-15 14:48">2017-02-15 14:48</time></a></p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p><img alt="" src="https://www.carnaghan.com/wp-content/uploads/2016/08/postgresql-logo.png"></p>
<p>A list of query scenarios on PostgreSQL database which might be helpful in some cases.</p>
<!-- TEASER_END: Read more -->

<h2>Table of Contents</h2>
<ol>
<li><a href="#sample-schema">Sample schema</a></li>
<li><a href="#update">UPDATE</a></li>
<li><a href="#delete">DELETE</a></li>
<li><a href="#wildcard">WILDCARD</a></li>
<li><a href="#join">JOIN</a></li>
<li><a href="sum-group-by-count">SUM, GROUP BY, COUNT</a></li>
<li><a href="#order-by">ORDER BY</a></li>
<li><a href="#create-table">CREATE TABLE</a></li>
<li><a href="#insert">INSERT</a></li>
<li><a href="#auto-increment">AUTO INCREMENT</a></li>
<li><a href="#serial">SERIAL</a></li>
<li><a href="#index">INDEX</a></li>
<li><a href="#drop">DROP</a></li>
<li><a href="#view">VIEW</a></li>
<li><a href="#built&amp;#45;in-functions">Built-in functions</a></li>
<li>
<p><a href="#nested-select">Nested select</a></p>
</li>
<li>
<h4>Sample schema:</h4>
</li>
</ol>
<pre class="code literal-block"><span></span><span class="c1">-- orders.customer_id = customers.id</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">"public"</span><span class="p">.</span><span class="ss">"orders"</span> <span class="p">(</span>
<span class="ss">"customer_id"</span> <span class="n">int4</span><span class="p">,</span>
<span class="ss">"id"</span> <span class="n">int4</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="ss">"product"</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="ss">"default"</span>
<span class="p">)</span>
<span class="k">WITH</span> <span class="p">(</span><span class="k">OIDS</span><span class="o">=</span><span class="k">FALSE</span><span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">"public"</span><span class="p">.</span><span class="ss">"items"</span> <span class="p">(</span>
<span class="ss">"name"</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COLLATE</span> <span class="ss">"default"</span><span class="p">,</span>
<span class="ss">"id"</span> <span class="n">int4</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="ss">"price"</span> <span class="nb">numeric</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">"public"</span><span class="p">.</span><span class="ss">"customers"</span> <span class="p">(</span>
<span class="ss">"first_name"</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="ss">"default"</span><span class="p">,</span>
<span class="ss">"id"</span> <span class="n">int4</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="ss">"last_name"</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">COLLATE</span> <span class="ss">"default"</span>
<span class="p">)</span>

<span class="c1">-- purchases.item_id = items.id</span>
<span class="c1">-- purchases.customer_id = customers.id</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">"public"</span><span class="p">.</span><span class="ss">"purchases"</span> <span class="p">(</span>
<span class="ss">"id"</span> <span class="n">int4</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="ss">"item_id"</span> <span class="n">int4</span><span class="p">,</span>
<span class="ss">"customer_id"</span> <span class="n">int4</span>
<span class="p">)</span>
</pre>


<ul>
<li>
<h4>UPDATE</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">UPDATE</span> <span class="n">items</span> <span class="k">set</span> <span class="n">price</span><span class="o">=</span><span class="mi">10</span><span class="p">.</span><span class="mi">00</span> <span class="k">where</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
</pre>


<ul>
<li>
<h4>DELETE</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">Delete</span> <span class="k">from</span> <span class="n">items</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</pre>


<ul>
<li>
<h4>WILDCARD</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">where</span> <span class="n">last_name</span> <span class="k">like</span> <span class="s1">'%t%'</span><span class="p">;</span>
<span class="c1">-- anything have t char in the middle</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">where</span> <span class="n">last_name</span> <span class="k">like</span> <span class="s1">'%t_'</span><span class="p">;</span>
<span class="c1">-- anything have t char in the middle, and exacly one char after</span>
</pre>


<ul>
<li>
<h4>JOIN</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">inner</span> <span class="k">join</span> <span class="n">orders</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>
<span class="c1">-- intersection like set, take the records which occur in both tables, most common</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">left</span> <span class="k">join</span> <span class="n">orders</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>
<span class="c1">-- list all record on the left table even it doesn not match data on the right table (left blank), most common</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">right</span> <span class="k">join</span> <span class="n">orders</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>
<span class="c1">-- list all record on the right table even it doesn not match data on the left table (left blank)</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">customers</span> <span class="k">full</span> <span class="k">join</span> <span class="n">orders</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span>
<span class="c1">-- list all record on the both tables even it doesn not match data of each other (left blank)</span>

<span class="k">select</span> <span class="n">customers</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">price</span> <span class="k">from</span> <span class="n">customers</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">customer_id</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">items</span> <span class="k">on</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">-- join 3 tables together, display selected columns</span>
</pre>


<ul>
<li>
<h4>SUM - GROUP BY - COUNT</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="n">customers</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">),</span> <span class="k">count</span><span class="p">(</span><span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">from</span> <span class="n">customers</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">customer_id</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">items</span> <span class="k">on</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span> <span class="k">group</span> <span class="k">by</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">-- join 3 tables, calculate how much money 1 customer spend, how many items each customer bought</span>

<span class="k">select</span> <span class="k">sum</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span><span class="p">;</span>
<span class="c1">-- calculate total money spent</span>
</pre>


<ul>
<li>
<h4>ORDER BY</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="n">customers</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_spent</span> <span class="k">from</span> <span class="n">customers</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">customer_id</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">items</span> <span class="k">on</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span> <span class="k">group</span> <span class="k">by</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="k">order</span> <span class="k">by</span> <span class="n">total_spent</span><span class="p">;</span>
<span class="c1">-- notice ORDER BY keyword</span>
</pre>


<ul>
<li>
<h4>CREATE TABLE</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">videos</span> <span class="p">(</span>
<span class="n">id</span> <span class="n">int4</span><span class="p">,</span>
<span class="n">customer_id</span> <span class="n">int4</span><span class="p">,</span>
<span class="n">name</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
<span class="k">constraint</span> <span class="n">videos_pkey</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="k">constraint</span> <span class="n">fk_videos_customers</span> <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">customer_id</span><span class="p">)</span> <span class="k">references</span> <span class="k">public</span><span class="p">.</span><span class="n">customers</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</pre>


<ul>
<li>
<h4>INSERT</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">INSERT</span> <span class="k">into</span> <span class="k">public</span><span class="p">.</span><span class="n">users</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'jose'</span><span class="p">);</span>
</pre>


<ul>
<li>
<h4>AUTO INCREMENT</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="n">sequence</span> <span class="n">users_id_seq</span> <span class="k">start</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- create auto increment variable</span>

<span class="k">alter</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">users</span>
<span class="k">alter</span> <span class="k">column</span> <span class="n">id</span>
<span class="k">set</span> <span class="k">default</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'users_id_seq'</span><span class="p">);</span>
<span class="c1">-- change users.id next value by using variable just created</span>

<span class="k">alter</span> <span class="n">sequence</span> <span class="n">users_id_seq</span> <span class="n">owned</span> <span class="k">by</span> <span class="k">public</span><span class="p">.</span><span class="n">users</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">-- create a dependency between sequence and id, so deleting id cause the same result on sequence</span>
</pre>


<ul>
<li>
<h4>SERIAL</h4>
<em>(easier to use than sequence)</em>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">test</span><span class="p">(</span>
<span class="n">id</span> <span class="nb">serial</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
<span class="n">name</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">)</span>
</pre>


<ul>
<li>
<h4>INDEX</h4>
<em>(help boosting query)</em>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">index</span> <span class="n">users_name_index</span> <span class="k">on</span> <span class="k">public</span><span class="p">.</span><span class="n">users</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="c1">-- create index on single field</span>

<span class="k">create</span> <span class="k">index</span> <span class="n">index_name</span> <span class="k">on</span> <span class="k">public</span><span class="p">.</span><span class="n">videos</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">);</span>
<span class="c1">-- helpful when ofen use 2 condition query (AND)</span>

<span class="k">reindex</span> <span class="k">index</span> <span class="n">users_name_index</span><span class="p">;</span>
<span class="c1">-- fixing corrupted index</span>

<span class="k">reindex</span> <span class="k">database</span> <span class="n">learning</span><span class="p">;</span>
<span class="c1">-- fixing corrupted database</span>
</pre>


<ul>
<li>
<h4>DROP</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">drop</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">users</span> <span class="k">cascade</span><span class="p">;</span>
<span class="c1">-- remove the foreign key relationship between current table and others (2 WAYS), data is untouched</span>
</pre>


<ul>
<li>
<h4>VIEW</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">view</span> <span class="n">total_spent_by_customer</span> <span class="k">as</span>
<span class="k">select</span> <span class="n">customers</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_spent</span> <span class="k">from</span> <span class="n">customers</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">customer_id</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">items</span> <span class="k">on</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span> <span class="err">\</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="k">order</span> <span class="k">by</span> <span class="n">total_spent</span><span class="p">;</span>
<span class="c1">-- we can use view to shorten the query,making it much more easier to revisit the full-length query, CAN NOT INSERT to view because "group by" contained</span>

<span class="k">drop</span> <span class="k">view</span> <span class="n">total_spent_by_customer</span><span class="p">;</span> <span class="o">#</span> <span class="k">drop</span> <span class="n">query</span>

<span class="k">create</span> <span class="k">view</span> <span class="n">expensive_items</span> <span class="k">as</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">items</span> <span class="k">where</span> <span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">with</span> <span class="k">local</span> <span class="k">check</span> <span class="k">option</span><span class="p">;</span>
<span class="c1">-- will affect the insert later on, need to obey the check</span>

<span class="k">insert</span> <span class="k">into</span> <span class="n">expensive_items</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'book'</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="c1">-- Failed, because price = 7 &lt; 100 local check option --&gt; can not insert</span>

<span class="k">create</span> <span class="k">view</span> <span class="n">unluxury_items</span> <span class="k">as</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">expensive_items</span> <span class="k">where</span> <span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">1000</span> <span class="k">with</span> <span class="k">local</span> <span class="k">check</span> <span class="k">option</span><span class="p">;</span>
<span class="c1">-- create view from another view</span>
</pre>


<ul>
<li>
<h4>Built-in functions</h4>
</li>
<li>
<h5>AVG, SUM, COUNT</h5>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span><span class="p">;</span>
</pre>


<ul>
<li>
<h5>MAX</h5>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">items</span><span class="p">.</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">items</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">item_id</span><span class="p">;</span>
<span class="c1">-- can not select item.name or else when using max function</span>
</pre>


<ul>
<li>
<h5>HAVING</h5>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">select</span> <span class="n">customers</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">customers</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">purchases</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="err">\</span>
<span class="n">item_count</span> <span class="k">from</span> <span class="n">customers</span> <span class="err">\</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">purchases</span> <span class="k">on</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">purchases</span><span class="p">.</span><span class="n">customer_id</span> <span class="err">\</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">customers</span><span class="p">.</span><span class="n">id</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">purchases</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- similiar to WHERE, which can not be used in this case (already grouped), always use having to check condition when querying with GROUP BY</span>
</pre>


<ul>
<li>
<h5>TYPE</h5>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">type</span> <span class="n">mood</span> <span class="k">as</span> <span class="n">enum</span><span class="p">(</span><span class="s1">'angry'</span><span class="p">,</span> <span class="s1">'sad'</span><span class="p">,</span> <span class="s1">'okay'</span><span class="p">,</span> <span class="s1">'happy'</span><span class="p">,</span> <span class="s1">'horny'</span><span class="p">);</span>
<span class="c1">-- create new custom mood</span>
</pre>


<pre class="code literal-block"><span></span><span class="k">create</span> <span class="k">table</span> <span class="k">public</span><span class="p">.</span><span class="n">students</span> <span class="p">(</span>
<span class="n">name</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="n">current_mood</span> <span class="n">mood</span>
<span class="p">)</span>
<span class="c1">-- how to create table with custom data type</span>
</pre>


<pre class="code literal-block"><span></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">students</span> <span class="k">where</span> <span class="n">current_mood</span> <span class="o">&gt;</span> <span class="s1">'okay'</span><span class="p">;</span>
<span class="c1">-- which return 'happy' and 'horny'</span>
</pre>


<ul>
<li>
<h4>Nested select</h4>
</li>
</ul>
<pre class="code literal-block"><span></span><span class="c1">-- select * from items where price &gt; avg(price) --&gt; FAILED</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">items</span> <span class="k">where</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span><span class="p">);</span>
<span class="c1">-- price larger than average price</span>

<span class="k">select</span> <span class="n">items</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="p">(</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span><span class="p">;</span>
<span class="c1">-- price diff</span>

<span class="k">select</span> <span class="n">items</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">price</span> <span class="o">-</span> <span class="p">(</span><span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span> <span class="k">where</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span> <span class="k">from</span> <span class="n">items</span> <span class="k">where</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">;</span>
<span class="c1">-- price diff of the item price &gt; 200</span>
</pre>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../blogs/delete-old-ebs-snaphot/" rel="prev" title="Delete old EBS snaphot">Previous post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents Â© 2017         <a href="mailto:me@tuanvm.com">Tuan Nguyen</a> 
            
        </footer>
</div>
</div>


            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/moment-with-locales.min.js"></script><script src="../../assets/js/fancydates.js"></script><script src="../../assets/js/jquery.colorbox-min.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.js"></script><script>anchors.add();
</script>
</body>
</html>
